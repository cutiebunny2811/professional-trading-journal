<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProTrade Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #18181b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }
        
        /* Animation utilities */
        .fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100 antialiased selection:bg-emerald-500/30">
    <div id="root"></div>

<script>
/** 
 * ==========================================
 * STATE & TYPES
 * ==========================================
 */
const STRATEGIES = ['Day Trade', 'Swing Trade', 'Options'];

// Initial State
const state = {
    transactions: JSON.parse(localStorage.getItem('protrade_journal_data') || '[]'),
    currentStrategy: 'Overview', // 'Overview' | 'Day Trade' | 'Swing Trade' | 'Options'
    currentDate: new Date(),
    
    // Modal State
    activeModal: null, // null | 'trade' | 'money'
    modalData: {} // temporary data for modal inputs
};

/** 
 * ==========================================
 * UTILITIES
 * ==========================================
 */
const generateId = () => Math.random().toString(36).substr(2, 9);

const formatCurrency = (amount) => {
    return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
    }).format(amount);
};

const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();

const saveData = () => {
    localStorage.setItem('protrade_journal_data', JSON.stringify(state.transactions));
    render();
};

/** 
 * CORE LOGIC: Statistics Calculation 
 * (Exact port from React version)
 */
const calculateStats = (transactions, filterStrategy) => {
    let investedCapital = 0;
    let netProfit = 0;
    let wins = 0;
    let losses = 0;
    let grossProfit = 0;
    let grossLoss = 0;
    let tradeCount = 0;

    // 1. Filter Capital Transactions (Deposits/Withdrawals)
    const capitalTransactions = transactions.filter(t => {
        if (t.type === 'TRADE') return false;
        if (filterStrategy === 'Overview') return true;
        return t.strategy === filterStrategy;
    });

    const deposits = capitalTransactions
        .filter(t => t.type === 'DEPOSIT')
        .reduce((acc, t) => acc + t.amount, 0);
    
    const withdrawals = capitalTransactions
        .filter(t => t.type === 'WITHDRAW')
        .reduce((acc, t) => acc + Math.abs(t.amount), 0);

    investedCapital = deposits - withdrawals;

    // 2. Filter Trades
    const relevantTrades = transactions.filter(t => {
        if (t.type !== 'TRADE') return false;
        if (filterStrategy === 'Overview') return true;
        return t.strategy === filterStrategy;
    });

    relevantTrades.forEach(t => {
        tradeCount++;
        netProfit += t.amount;
        if (t.amount > 0) {
            wins++;
            grossProfit += t.amount;
        } else if (t.amount < 0) {
            losses++;
            grossLoss += Math.abs(t.amount);
        }
    });

    // 3. Derived Stats
    const portfolioValue = investedCapital + netProfit;
    const winRate = tradeCount > 0 ? (wins / tradeCount) * 100 : 0;
    const avgWin = wins > 0 ? grossProfit / wins : 0;
    const avgLoss = losses > 0 ? grossLoss / losses : 0;
    const profitFactor = grossLoss > 0 ? grossProfit / grossLoss : (grossProfit > 0 ? 999 : 0);
    const roi = investedCapital > 0 ? (netProfit / investedCapital) * 100 : 0;

    return {
        portfolioValue,
        investedCapital,
        netProfit,
        roi,
        winRate,
        totalTrades: tradeCount,
        avgWin,
        avgLoss,
        profitFactor,
    };
};

/** 
 * ==========================================
 * ACTIONS (Event Handlers)
 * ==========================================
 */
window.switchTab = (strategy) => {
    state.currentStrategy = strategy;
    render();
};

window.changeDate = (months) => {
    const newDate = new Date(state.currentDate);
    newDate.setMonth(newDate.getMonth() + months);
    state.currentDate = newDate;
    render();
};

window.openModal = (type, dateStr = null) => {
    const today = new Date().toISOString().split('T')[0];
    
    // Default strategy logic
    let defaultStrategy = 'Day Trade';
    if (state.currentStrategy !== 'Overview') {
        defaultStrategy = state.currentStrategy;
    }

    state.activeModal = type;
    state.modalData = {
        date: dateStr || today,
        strategy: defaultStrategy,
        amount: '',
        type: 'DEPOSIT', // for money modal
        isWin: true // for trade modal
    };
    render();
};

window.closeModal = () => {
    state.activeModal = null;
    render();
};

// Modal Input Handlers (updates state.modalData without full re-render for perf, effectively)
// Actually, for simplicity in Vanilla JS, we'll read strictly from DOM on submit, 
// but we need to toggle UI states like "Win/Loss" buttons.
window.setModalState = (key, value) => {
    state.modalData[key] = value;
    // We need to update the UI classes for buttons if we toggle Win/Loss or Deposit/Withdraw
    if (key === 'isWin' || key === 'type') {
        render(); // Re-render to show active button state
    }
};

window.submitTrade = (e) => {
    e.preventDefault();
    const form = e.target;
    const date = form.date.value;
    const strategy = form.strategy.value;
    const rawAmount = parseFloat(form.amount.value);
    
    if (isNaN(rawAmount)) return;

    const finalAmount = state.modalData.isWin ? Math.abs(rawAmount) : -Math.abs(rawAmount);

    state.transactions.push({
        id: generateId(),
        date,
        type: 'TRADE',
        amount: finalAmount,
        strategy
    });
    
    saveData();
    closeModal();
};

window.submitMoney = (e) => {
    e.preventDefault();
    const form = e.target;
    const date = form.date.value;
    const strategy = form.strategy.value;
    const rawAmount = parseFloat(form.amount.value);
    const type = state.modalData.type;

    if (isNaN(rawAmount)) return;

    state.transactions.push({
        id: generateId(),
        date,
        type: type,
        amount: type === 'WITHDRAW' ? -Math.abs(rawAmount) : Math.abs(rawAmount),
        strategy
    });

    saveData();
    closeModal();
};

window.deleteTransaction = (id) => {
    state.transactions = state.transactions.filter(t => t.id !== id);
    saveData();
};

/** 
 * ==========================================
 * COMPONENTS (HTML Generators)
 * ==========================================
 */

const StatsCard = ({ label, value, subValue, icon, color = 'default' }) => {
    const colors = {
        default: 'text-zinc-100 bg-zinc-800',
        emerald: 'text-emerald-400 bg-emerald-900/50',
        rose: 'text-rose-400 bg-rose-900/50',
        blue: 'text-blue-400 bg-blue-900/50'
    };
    
    const borders = {
        default: 'bg-zinc-900 border-zinc-800',
        emerald: 'bg-emerald-950/20 border-emerald-900/50',
        rose: 'bg-rose-950/20 border-rose-900/50',
        blue: 'bg-blue-950/20 border-blue-900/50'
    };

    return `
    <div class="p-4 rounded-xl border ${borders[color]} flex items-start justify-between transition-all hover:scale-[1.01]">
        <div>
            <p class="text-sm font-medium text-zinc-400 mb-1">${label}</p>
            <h3 class="text-2xl font-bold ${color.includes('emerald') ? 'text-emerald-400' : color.includes('rose') ? 'text-rose-400' : color.includes('blue') ? 'text-blue-400' : 'text-zinc-100'}">${value}</h3>
            ${subValue ? `<p class="text-xs text-zinc-500 mt-1">${subValue}</p>` : ''}
        </div>
        <div class="p-2 rounded-lg ${colors[color]}">
            <i data-lucide="${icon}" width="20" height="20"></i>
        </div>
    </div>
    `;
};

const CalendarComponent = () => {
    const year = state.currentDate.getFullYear();
    const month = state.currentDate.getMonth();
    const daysInMonth = getDaysInMonth(year, month);
    const firstDay = getFirstDayOfMonth(year, month);
    const monthName = state.currentDate.toLocaleString('default', { month: 'long' });

    // Pre-calculate daily performance
    const dailyPerf = {};
    state.transactions.forEach(t => {
        if (t.type !== 'TRADE') return;
        if (state.currentStrategy !== 'Overview' && t.strategy !== state.currentStrategy) return;
        dailyPerf[t.date] = (dailyPerf[t.date] || 0) + t.amount;
    });

    let daysHtml = '';
    // Empty slots
    for (let i = 0; i < firstDay; i++) {
        daysHtml += `<div class="h-24 bg-zinc-950/50 border border-zinc-900/50"></div>`;
    }
    // Days
    for (let d = 1; d <= daysInMonth; d++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
        const val = dailyPerf[dateStr];
        const hasTrade = val !== undefined;
        const isProfit = hasTrade && val >= 0;
        const isLoss = hasTrade && val < 0;
        
        const bgClass = isProfit ? 'bg-emerald-950/30 hover:bg-emerald-900/40 border-emerald-900/30' 
                      : isLoss ? 'bg-rose-950/30 hover:bg-rose-900/40 border-rose-900/30'
                      : 'bg-zinc-900/30 hover:bg-zinc-800';

        const textClass = isProfit ? 'text-emerald-400' : 'text-rose-400';

        daysHtml += `
        <div onclick="openModal('trade', '${dateStr}')" 
             class="h-24 p-2 border border-zinc-800/50 relative group cursor-pointer transition-colors ${hasTrade ? bgClass : 'bg-zinc-900/30 hover:bg-zinc-800'}">
            <span class="text-xs text-zinc-500 font-medium group-hover:text-zinc-300">${d}</span>
            ${hasTrade ? `
            <div class="absolute bottom-2 right-2 text-sm font-bold ${textClass}">
                ${val > 0 ? '+' : ''}${formatCurrency(val)}
            </div>` : ''}
        </div>
        `;
    }

    return `
    <div class="bg-zinc-900 rounded-xl border border-zinc-800 overflow-hidden shadow-sm">
        <div class="p-4 flex items-center justify-between border-b border-zinc-800 bg-zinc-900">
            <h2 class="text-lg font-semibold text-zinc-100 flex items-center gap-2">Performance Calendar</h2>
            <div class="flex items-center gap-2">
                <button onclick="changeDate(-1)" class="p-2 hover:bg-zinc-800 rounded-lg text-zinc-400 hover:text-white"><i data-lucide="chevron-left"></i></button>
                <span class="text-zinc-200 font-medium w-32 text-center">${monthName} ${year}</span>
                <button onclick="changeDate(1)" class="p-2 hover:bg-zinc-800 rounded-lg text-zinc-400 hover:text-white"><i data-lucide="chevron-right"></i></button>
            </div>
        </div>
        <div class="grid grid-cols-7 text-center py-2 border-b border-zinc-800 bg-zinc-950/30 text-xs font-medium text-zinc-500 uppercase tracking-wider">
            <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
        </div>
        <div class="grid grid-cols-7 bg-zinc-900">
            ${daysHtml}
        </div>
    </div>
    `;
};

const TransactionListComponent = () => {
    const recent = [...state.transactions]
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 5);

    if (recent.length === 0) {
        return `
        <div class="bg-zinc-900 rounded-xl border border-zinc-800 p-8 text-center h-full">
            <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-zinc-800 mb-4">
                <i data-lucide="activity" class="text-zinc-500"></i>
            </div>
            <h3 class="text-zinc-300 font-medium">No transactions yet</h3>
            <p class="text-zinc-500 text-sm mt-1">Add trades or deposits to start tracking.</p>
        </div>`;
    }

    const rows = recent.map(t => {
        const isProfit = t.amount >= 0;
        const colorClass = isProfit ? 'text-emerald-400' : 'text-rose-400';
        const typeStyles = {
            'DEPOSIT': 'bg-emerald-900/30 text-emerald-400 border-emerald-900/50',
            'WITHDRAW': 'bg-rose-900/30 text-rose-400 border-rose-900/50',
            'TRADE': 'bg-blue-900/30 text-blue-400 border-blue-900/50'
        };

        return `
        <tr class="hover:bg-zinc-800/30 transition-colors">
            <td class="px-6 py-4 text-zinc-300 font-medium whitespace-nowrap">${t.date}</td>
            <td class="px-6 py-4">
                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold border ${typeStyles[t.type]}">
                    ${t.type}
                </span>
            </td>
            <td class="px-6 py-4 text-zinc-400">${t.strategy || '-'}</td>
            <td class="px-6 py-4 text-right font-bold ${colorClass}">
                <div class="flex items-center justify-end gap-1">
                    <i data-lucide="${t.amount > 0 ? 'arrow-up-right' : 'arrow-down-right'}" width="14"></i>
                    ${formatCurrency(Math.abs(t.amount))}
                </div>
            </td>
            <td class="px-6 py-4 text-center">
                <button onclick="deleteTransaction('${t.id}')" class="p-1.5 text-zinc-500 hover:text-rose-400 hover:bg-rose-950/30 rounded-md transition-colors">
                    <i data-lucide="trash-2" width="16"></i>
                </button>
            </td>
        </tr>
        `;
    }).join('');

    return `
    <div class="bg-zinc-900 rounded-xl border border-zinc-800 overflow-hidden h-full">
        <div class="p-4 border-b border-zinc-800">
            <h2 class="text-lg font-semibold text-zinc-100">Recent Transactions</h2>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left">
                <thead class="text-xs text-zinc-500 uppercase bg-zinc-950/50">
                    <tr>
                        <th class="px-6 py-3 font-medium">Date</th>
                        <th class="px-6 py-3 font-medium">Type</th>
                        <th class="px-6 py-3 font-medium">Strategy</th>
                        <th class="px-6 py-3 font-medium text-right">Amount</th>
                        <th class="px-6 py-3 font-medium text-center">Action</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-zinc-800">
                    ${rows}
                </tbody>
            </table>
        </div>
    </div>
    `;
};

const TradeModal = () => {
    if (state.activeModal !== 'trade') return '';
    const { date, strategy, isWin } = state.modalData;

    return `
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm fade-in">
        <div class="bg-zinc-900 w-full max-w-md rounded-2xl border border-zinc-800 shadow-2xl">
            <div class="flex items-center justify-between p-4 border-b border-zinc-800">
                <h3 class="text-lg font-bold text-white">Add Trade</h3>
                <button onclick="closeModal()" class="p-1 hover:bg-zinc-800 rounded-lg text-zinc-500 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            <div class="p-6">
                <form onsubmit="submitTrade(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-zinc-400 mb-1">Date</label>
                        <input type="date" name="date" required value="${date}" class="w-full bg-zinc-950 border border-zinc-800 rounded-lg p-2.5 text-white focus:ring-2 focus:ring-emerald-500/50 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-zinc-400 mb-1">Strategy</label>
                        <select name="strategy" class="w-full bg-zinc-950 border border-zinc-800 rounded-lg p-2.5 text-white focus:ring-2 focus:ring-emerald-500/50 outline-none">
                            ${STRATEGIES.map(s => `<option value="${s}" ${s === strategy ? 'selected' : ''}>${s}</option>`).join('')}
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-400 mb-1">Outcome</label>
                            <div class="flex bg-zinc-950 rounded-lg p-1 border border-zinc-800">
                                <button type="button" onclick="setModalState('isWin', true)" class="flex-1 text-sm py-1.5 rounded-md transition-all font-medium ${isWin ? 'bg-emerald-600 text-white shadow-lg' : 'text-zinc-400 hover:text-white'}">Win</button>
                                <button type="button" onclick="setModalState('isWin', false)" class="flex-1 text-sm py-1.5 rounded-md transition-all font-medium ${!isWin ? 'bg-rose-600 text-white shadow-lg' : 'text-zinc-400 hover:text-white'}">Loss</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-zinc-400 mb-1">P/L Amount ($)</label>
                            <input type="number" name="amount" step="0.01" min="0" required placeholder="0.00" class="w-full bg-zinc-950 border border-zinc-800 rounded-lg p-2.5 text-white focus:ring-2 focus:ring-emerald-500/50 outline-none">
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-emerald-500 hover:bg-emerald-400 text-zinc-950 font-bold py-3 rounded-lg transition-colors mt-6">Save Trade</button>
                </form>
            </div>
        </div>
    </div>
    `;
};

const MoneyModal = () => {
    if (state.activeModal !== 'money') return '';
    const { date, strategy, type } = state.modalData;

    return `
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm fade-in">
        <div class="bg-zinc-900 w-full max-w-md rounded-2xl border border-zinc-800 shadow-2xl">
            <div class="flex items-center justify-between p-4 border-b border-zinc-800">
                <h3 class="text-lg font-bold text-white">Manage Funds</h3>
                <button onclick="closeModal()" class="p-1 hover:bg-zinc-800 rounded-lg text-zinc-500 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            <div class="p-6">
                <form onsubmit="submitMoney(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-zinc-400 mb-1">Date</label>
                        <input type="date" name="date" required value="${date}" class="w-full bg-zinc-950 border border-zinc-800 rounded-lg p-2.5 text-white focus:ring-2 focus:ring-blue-500/50 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-zinc-400 mb-1">Transaction Type</label>
                        <div class="flex bg-zinc-950 rounded-lg p-1 border border-zinc-800">
                            <button type="button" onclick="setModalState('type', 'DEPOSIT')" class="flex-1 text-sm py-2 rounded-md transition-all font-medium ${type === 'DEPOSIT' ? 'bg-emerald-600 text-white shadow-lg' : 'text-zinc-400 hover:text-white'}">Deposit</button>
                            <button type="button" onclick="setModalState('type', 'WITHDRAW')" class="flex-1 text-sm py-2 rounded-md transition-all font-medium ${type === 'WITHDRAW' ? 'bg-rose-600 text-white shadow-lg' : 'text-zinc-400 hover:text-white'}">Withdraw</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-zinc-400 mb-1">Allocated Strategy</label>
                        <select name="strategy" class="w-full bg-zinc-950 border border-zinc-800 rounded-lg p-2.5 text-white focus:ring-2 focus:ring-blue-500/50 outline-none">
                            ${STRATEGIES.map(s => `<option value="${s}" ${s === strategy ? 'selected' : ''}>${s}</option>`).join('')}
                        </select>
                        <p class="text-xs text-zinc-500 mt-1">Funds will be added to this strategy's capital.</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-zinc-400 mb-1">Amount ($)</label>
                        <input type="number" name="amount" step="0.01" min="0" required placeholder="0.00" class="w-full bg-zinc-950 border border-zinc-800 rounded-lg p-2.5 text-white focus:ring-2 focus:ring-blue-500/50 outline-none">
                    </div>
                    <button type="submit" class="w-full bg-zinc-100 hover:bg-white text-zinc-900 font-bold py-3 rounded-lg transition-colors mt-6">
                        ${type === 'DEPOSIT' ? 'Deposit Funds' : 'Withdraw Funds'}
                    </button>
                </form>
            </div>
        </div>
    </div>
    `;
};

/** 
 * ==========================================
 * MAIN RENDER
 * ==========================================
 */
const render = () => {
    const root = document.getElementById('root');
    const stats = calculateStats(state.transactions, state.currentStrategy);

    // Build Tabs
    const tabsHtml = ['Overview', ...STRATEGIES].map(tab => `
        <button onclick="switchTab('${tab}')" 
            class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${state.currentStrategy === tab ? 'bg-zinc-100 text-zinc-900 shadow-sm' : 'text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800/50'}">
            ${tab}
        </button>
    `).join('');

    // HTML Structure
    root.innerHTML = `
    <div class="min-h-screen pb-20">
        <!-- Header -->
        <header class="bg-zinc-900 border-b border-zinc-800 sticky top-0 z-30">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="bg-emerald-500/10 p-2 rounded-lg border border-emerald-500/20">
                        <i data-lucide="trending-up" class="text-emerald-500"></i>
                    </div>
                    <h1 class="text-xl font-bold tracking-tight text-white">ProTrade <span class="text-zinc-500 font-normal">Journal</span></h1>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="openModal('money')" class="hidden sm:flex items-center gap-2 px-4 py-2 text-sm font-medium text-zinc-300 hover:text-white bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors border border-zinc-700">
                        <i data-lucide="wallet" width="16"></i> Manage Funds
                    </button>
                    <button onclick="openModal('trade')" class="flex items-center gap-2 px-4 py-2 text-sm font-bold text-zinc-950 bg-emerald-500 hover:bg-emerald-400 rounded-lg transition-colors shadow-lg shadow-emerald-900/20">
                        <i data-lucide="plus" width="18"></i> Add Trade
                    </button>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
            <!-- Tabs -->
            <div class="flex flex-wrap gap-2 p-1 bg-zinc-900/50 backdrop-blur rounded-xl border border-zinc-800/50 w-fit">
                ${tabsHtml}
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                ${StatsCard({ label: 'Portfolio Value', value: formatCurrency(stats.portfolioValue), icon: 'wallet', color: 'emerald', subValue: state.currentStrategy !== 'Overview' ? 'Strategy Value' : 'Global Value' })}
                ${StatsCard({ label: 'Net Profit', value: formatCurrency(stats.netProfit), icon: 'dollar-sign', color: stats.netProfit >= 0 ? 'emerald' : 'rose' })}
                ${StatsCard({ label: 'ROI', value: stats.roi.toFixed(2) + '%', icon: 'trending-up', color: stats.roi >= 0 ? 'emerald' : 'rose' })}
                ${StatsCard({ label: 'Win Rate', value: stats.winRate.toFixed(1) + '%', icon: 'target', color: 'blue', subValue: stats.totalTrades + ' Trades' })}
                
                ${StatsCard({ label: 'Avg Win', value: formatCurrency(stats.avgWin), icon: 'arrow-left-right' })}
                ${StatsCard({ label: 'Avg Loss', value: formatCurrency(stats.avgLoss), icon: 'arrow-left-right' })}
                ${StatsCard({ label: 'Profit Factor', value: stats.profitFactor.toFixed(2), icon: 'bar-chart-2' })}
                ${StatsCard({ label: 'Invested Capital', value: formatCurrency(stats.investedCapital), icon: 'settings' })}
            </div>

            <!-- Dashboard Split -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-6">
                    ${CalendarComponent()}
                </div>
                <div class="lg:col-span-1">
                    ${TransactionListComponent()}
                </div>
            </div>
        </main>

        <!-- Modals -->
        ${TradeModal()}
        ${MoneyModal()}
    </div>
    `;

    // Initialize Icons
    lucide.createIcons();
};

// Initial Render
render();

</script>
</body>
</html>