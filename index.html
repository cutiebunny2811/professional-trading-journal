<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ProTrade Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #18181b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }
        .fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        body { font-family: 'Inter', sans-serif; background-color: #09090b; color: #e4e4e7; }
        input, select, textarea { background-color: #18181b; border-color: #27272a; color: white; }
        input:focus, select:focus, textarea:focus { border-color: #10b981; outline: none; ring: 0; }
    </style>
</head>
<body class="min-h-screen pb-20">

    <div id="app" class="max-w-7xl mx-auto p-4 md:p-6 space-y-6">
        
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <div class="bg-emerald-500/10 p-2 rounded-xl border border-emerald-500/20">
                    <i data-lucide="bar-chart-2" class="w-6 h-6 text-emerald-500"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight text-white">ProTrade <span class="text-zinc-500 font-medium">Journal</span></h1>
                    <p class="text-xs text-zinc-500">Track your edge, master the markets.</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="toggleModal('modal-settings')" class="p-2.5 rounded-lg border border-zinc-800 hover:bg-zinc-800 text-zinc-400 transition-colors">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                </button>
                <button onclick="toggleModal('modal-funds')" class="flex items-center gap-2 px-4 py-2.5 rounded-lg border border-zinc-800 hover:bg-zinc-800 text-zinc-300 text-sm font-medium transition-colors">
                    <i data-lucide="wallet" class="w-4 h-4"></i> Manage Funds
                </button>
                <button onclick="openAddTrade()" class="flex items-center gap-2 px-4 py-2.5 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white text-sm font-bold shadow-lg shadow-emerald-900/20 transition-all">
                    <i data-lucide="plus" class="w-4 h-4"></i> Add Trade
                </button>
            </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-zinc-900/50 border border-zinc-800 p-4 rounded-xl relative overflow-hidden group hover:border-zinc-700 transition-colors">
                <div class="flex justify-between items-start mb-2"><span class="text-xs text-zinc-500 font-bold uppercase">Portfolio Value</span><i data-lucide="briefcase" class="w-4 h-4 text-emerald-500 opacity-50"></i></div>
                <div id="stat-port-val" class="text-2xl font-black text-white">$0.00</div>
                <div class="text-[10px] text-zinc-600 mt-1">Global Value</div>
            </div>
            <div class="bg-zinc-900/50 border border-zinc-800 p-4 rounded-xl relative overflow-hidden group hover:border-zinc-700 transition-colors">
                <div class="flex justify-between items-start mb-2"><span class="text-xs text-zinc-500 font-bold uppercase">Net Profit</span><i data-lucide="dollar-sign" class="w-4 h-4 text-emerald-500 opacity-50"></i></div>
                <div id="stat-net-profit" class="text-2xl font-black text-zinc-500">$0.00</div>
            </div>
            <div class="bg-zinc-900/50 border border-zinc-800 p-4 rounded-xl relative overflow-hidden group hover:border-zinc-700 transition-colors">
                <div class="flex justify-between items-start mb-2"><span class="text-xs text-zinc-500 font-bold uppercase">ROI</span><i data-lucide="trending-up" class="w-4 h-4 text-emerald-500 opacity-50"></i></div>
                <div id="stat-roi" class="text-2xl font-black text-emerald-500">0.00%</div>
            </div>
            <div class="bg-zinc-900/50 border border-zinc-800 p-4 rounded-xl relative overflow-hidden group hover:border-zinc-700 transition-colors">
                <div class="flex justify-between items-start mb-2"><span class="text-xs text-zinc-500 font-bold uppercase">Win Rate</span><i data-lucide="target" class="w-4 h-4 text-blue-500 opacity-50"></i></div>
                <div id="stat-win-rate" class="text-2xl font-black text-blue-500">0.0%</div>
                <div id="stat-total-trades" class="text-[10px] text-zinc-600 mt-1">0 Trades</div>
            </div>
            <div class="bg-zinc-900/30 border border-zinc-800 p-4 rounded-xl"><p class="text-[10px] text-zinc-500 uppercase font-bold mb-1">Avg Win</p><p id="stat-avg-win" class="text-lg font-bold text-white">$0.00</p></div>
             <div class="bg-zinc-900/30 border border-zinc-800 p-4 rounded-xl"><p class="text-[10px] text-zinc-500 uppercase font-bold mb-1">Avg Loss</p><p id="stat-avg-loss" class="text-lg font-bold text-white">$0.00</p></div>
             <div class="bg-zinc-900/30 border border-zinc-800 p-4 rounded-xl"><p class="text-[10px] text-zinc-500 uppercase font-bold mb-1">Profit Factor</p><p id="stat-pf" class="text-lg font-bold text-white">0.00</p></div>
             <div class="bg-zinc-900/30 border border-zinc-800 p-4 rounded-xl"><p class="text-[10px] text-zinc-500 uppercase font-bold mb-1">Invested Capital</p><p id="stat-invested" class="text-lg font-bold text-white">$0.00</p></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-2 bg-zinc-900 border border-zinc-800 rounded-2xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="font-bold text-white flex items-center gap-2"><i data-lucide="calendar" class="w-4 h-4 text-zinc-500"></i> Performance Calendar</h3>
                    <div class="flex gap-2">
                        <button onclick="changeMonth(-1)" class="p-1 hover:bg-zinc-800 rounded text-zinc-400"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                        <span id="cal-month-year" class="text-sm font-bold text-white w-32 text-center pt-1">...</span>
                        <button onclick="changeMonth(1)" class="p-1 hover:bg-zinc-800 rounded text-zinc-400"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                    </div>
                </div>
                <div class="grid grid-cols-7 mb-2 text-center">
                    <div class="text-[10px] font-bold text-zinc-600 uppercase">Sun</div>
                    <div class="text-[10px] font-bold text-zinc-600 uppercase">Mon</div>
                    <div class="text-[10px] font-bold text-zinc-600 uppercase">Tue</div>
                    <div class="text-[10px] font-bold text-zinc-600 uppercase">Wed</div>
                    <div class="text-[10px] font-bold text-zinc-600 uppercase">Thu</div>
                    <div class="text-[10px] font-bold text-zinc-600 uppercase">Fri</div>
                    <div class="text-[10px] font-bold text-zinc-600 uppercase">Sat</div>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 gap-1 md:gap-2 h-96"></div>
            </div>

            <div class="bg-zinc-900 border border-zinc-800 rounded-2xl p-6 flex flex-col">
                <h3 class="font-bold text-white mb-4 flex items-center gap-2"><i data-lucide="list" class="w-4 h-4 text-zinc-500"></i> Recent Activity</h3>
                <div id="tx-list" class="flex-1 overflow-y-auto space-y-2 pr-1 max-h-[500px]">
                    </div>
            </div>
        </div>

    </div>

    <div id="modal-trade" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50 fade-in">
        <div class="bg-zinc-900 w-full max-w-md rounded-2xl border border-zinc-800 p-6 space-y-4 shadow-2xl">
            <h3 class="text-lg font-bold text-white">Record Trade</h3>
            <div class="grid grid-cols-2 gap-3">
                <input type="date" id="t-date" class="bg-black border border-zinc-800 rounded-xl p-3 text-sm text-white">
                <select id="t-type" class="bg-black border border-zinc-800 rounded-xl p-3 text-sm text-white">
                    <option value="Buy">Long / Buy</option>
                    <option value="Sell">Short / Sell</option>
                </select>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <input type="text" id="t-ticker" placeholder="Ticker (e.g. TSLA)" class="bg-black border border-zinc-800 rounded-xl p-3 text-sm text-white uppercase font-bold">
                <input type="text" id="t-strategy" placeholder="Strategy" class="bg-black border border-zinc-800 rounded-xl p-3 text-sm text-white">
            </div>
            <div class="grid grid-cols-2 gap-3">
                <input type="number" id="t-pl" placeholder="P/L ($)" class="bg-black border border-zinc-800 rounded-xl p-3 text-sm text-white font-bold">
                <input type="number" id="t-roi" placeholder="ROI (%)" class="bg-black border border-zinc-800 rounded-xl p-3 text-sm text-white">
            </div>
            <textarea id="t-notes" rows="2" placeholder="Notes..." class="w-full bg-black border border-zinc-800 rounded-xl p-3 text-sm text-white resize-none"></textarea>
            
            <div class="flex gap-2 pt-2">
                <button onclick="toggleModal('modal-trade')" class="flex-1 py-3 rounded-xl bg-zinc-800 text-zinc-400 font-bold text-sm">Cancel</button>
                <button onclick="saveTrade()" class="flex-1 py-3 rounded-xl bg-emerald-600 text-white font-bold text-sm">Save Trade</button>
            </div>
        </div>
    </div>

    <div id="modal-funds" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50 fade-in">
        <div class="bg-zinc-900 w-full max-w-sm rounded-2xl border border-zinc-800 p-6 space-y-4 shadow-2xl">
            <h3 class="text-lg font-bold text-white">Manage Funds</h3>
            <div>
                <label class="text-xs text-zinc-500 uppercase font-bold block mb-2">Deposit / Withdraw</label>
                <input type="number" id="f-amount" placeholder="Amount ($)" class="w-full bg-black border border-zinc-800 rounded-xl p-3 text-white font-bold text-lg">
                <p class="text-[10px] text-zinc-600 mt-1">Positive for Deposit, Negative for Withdrawal</p>
            </div>
            <div class="flex gap-2 pt-2">
                <button onclick="toggleModal('modal-funds')" class="flex-1 py-3 rounded-xl bg-zinc-800 text-zinc-400 font-bold text-sm">Cancel</button>
                <button onclick="saveFund()" class="flex-1 py-3 rounded-xl bg-blue-600 text-white font-bold text-sm">Update Balance</button>
            </div>
        </div>
    </div>

    <div id="modal-settings" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50 fade-in">
        <div class="bg-zinc-900 w-full max-w-sm rounded-2xl border border-zinc-800 p-6 space-y-4 shadow-2xl">
            <h3 class="text-lg font-bold text-white flex items-center gap-2"><i data-lucide="database" class="w-4 h-4"></i> Data Backup</h3>
            
            <div class="space-y-3">
                <button onclick="exportData()" class="w-full flex items-center justify-between p-4 rounded-xl bg-zinc-800 hover:bg-zinc-700 border border-zinc-700/50 transition-all">
                    <div class="text-left">
                        <div class="font-bold text-white text-sm">Copy Data to Clipboard</div>
                        <div class="text-[10px] text-zinc-400">Save this text to keep your data safe</div>
                    </div>
                    <i data-lucide="copy" class="w-5 h-5 text-emerald-500"></i>
                </button>

                <button onclick="importData()" class="w-full flex items-center justify-between p-4 rounded-xl bg-zinc-800 hover:bg-zinc-700 border border-zinc-700/50 transition-all">
                    <div class="text-left">
                        <div class="font-bold text-white text-sm">Import Data</div>
                        <div class="text-[10px] text-zinc-400">Paste your backup text here to restore</div>
                    </div>
                    <i data-lucide="download" class="w-5 h-5 text-blue-500"></i>
                </button>

                 <button onclick="resetData()" class="w-full flex items-center justify-between p-4 rounded-xl bg-rose-900/20 hover:bg-rose-900/30 border border-rose-900/50 transition-all mt-4">
                    <div class="text-left">
                        <div class="font-bold text-rose-400 text-sm">Reset All Data</div>
                        <div class="text-[10px] text-rose-500/70">Clear everything and start fresh</div>
                    </div>
                    <i data-lucide="trash-2" class="w-5 h-5 text-rose-500"></i>
                </button>
            </div>

            <button onclick="toggleModal('modal-settings')" class="w-full py-3 rounded-xl bg-zinc-950 border border-zinc-800 text-zinc-400 font-bold text-sm mt-2">Close</button>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // --- STATE ---
        let trades = JSON.parse(localStorage.getItem('ptj_trades')) || [];
        let balance = parseFloat(localStorage.getItem('ptj_balance')) || 0;
        let invested = parseFloat(localStorage.getItem('ptj_invested')) || 0;

        let currentDate = new Date(); // For calendar view

        const moneyFmt = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });

        // --- INIT ---
        renderStats();
        renderCalendar();
        renderTrades();

        // --- CORE FUNCTIONS ---
        function toggleModal(id) {
            const m = document.getElementById(id);
            if (m.classList.contains('hidden')) {
                m.classList.remove('hidden');
                m.classList.add('flex');
                if(id==='modal-trade') document.getElementById('t-date').valueAsDate = new Date();
            } else {
                m.classList.add('hidden');
                m.classList.remove('flex');
            }
        }

        function openAddTrade() { toggleModal('modal-trade'); }

        function saveTrade() {
            const date = document.getElementById('t-date').value;
            const ticker = document.getElementById('t-ticker').value.toUpperCase();
            const pl = parseFloat(document.getElementById('t-pl').value);
            const roi = parseFloat(document.getElementById('t-roi').value) || 0;
            const type = document.getElementById('t-type').value;
            const strategy = document.getElementById('t-strategy').value;
            const notes = document.getElementById('t-notes').value;

            if(!date || !ticker || isNaN(pl)) return alert("Please fill Date, Ticker and P/L");

            const trade = { id: Date.now(), date, ticker, pl, roi, type, strategy, notes };
            trades.push(trade);
            // Sort by date desc
            trades.sort((a,b) => new Date(b.date) - new Date(a.date));
            
            saveData();
            renderStats(); renderCalendar(); renderTrades();
            toggleModal('modal-trade');
            
            // Clear inputs
            document.getElementById('t-ticker').value = ''; document.getElementById('t-pl').value = '';
            document.getElementById('t-roi').value = ''; document.getElementById('t-strategy').value = '';
            document.getElementById('t-notes').value = '';
        }

        function saveFund() {
            const amt = parseFloat(document.getElementById('f-amount').value);
            if(isNaN(amt)) return alert("Invalid amount");
            
            // Logic: Deposit increases invested cap & balance. Withdraw decreases.
            invested += amt;
            balance += amt; // Initial balance adj
            
            localStorage.setItem('ptj_invested', invested);
            saveData();
            renderStats();
            toggleModal('modal-funds');
            document.getElementById('f-amount').value = '';
        }

        function deleteTrade(id) {
            if(confirm("Delete this trade?")) {
                trades = trades.filter(t => t.id !== id);
                saveData();
                renderStats(); renderCalendar(); renderTrades();
            }
        }

        // --- RENDERING ---
        function renderStats() {
            let netProfit = 0;
            let wins = 0;
            let losses = 0;
            let totalWinAmt = 0;
            let totalLossAmt = 0;

            trades.forEach(t => {
                netProfit += t.pl;
                if(t.pl > 0) { wins++; totalWinAmt += t.pl; }
                else if(t.pl < 0) { losses++; totalLossAmt += Math.abs(t.pl); }
            });

            const totalTrades = wins + losses; // Exclude breakeven for simplistic winrate
            const winRate = totalTrades > 0 ? (wins / totalTrades) * 100 : 0;
            const avgWin = wins > 0 ? totalWinAmt / wins : 0;
            const avgLoss = losses > 0 ? totalLossAmt / losses : 0;
            const pf = totalLossAmt > 0 ? totalWinAmt / totalLossAmt : (totalWinAmt > 0 ? 99.99 : 0);
            
            const currentPort = invested + netProfit; // Simple logic: Initial + Profits
            const totalRoi = invested > 0 ? (netProfit / invested) * 100 : 0;

            document.getElementById('stat-port-val').innerText = moneyFmt.format(currentPort);
            document.getElementById('stat-net-profit').innerText = (netProfit>=0?'+':'') + moneyFmt.format(netProfit);
            document.getElementById('stat-net-profit').className = `text-2xl font-black ${netProfit>=0?'text-emerald-500':'text-rose-500'}`;
            
            document.getElementById('stat-roi').innerText = (totalRoi>=0?'+':'') + totalRoi.toFixed(2) + '%';
            document.getElementById('stat-roi').className = `text-2xl font-black ${totalRoi>=0?'text-emerald-500':'text-rose-500'}`;
            
            document.getElementById('stat-win-rate').innerText = winRate.toFixed(1) + '%';
            document.getElementById('stat-total-trades').innerText = `${trades.length} Trades`;
            
            document.getElementById('stat-avg-win').innerText = moneyFmt.format(avgWin);
            document.getElementById('stat-avg-loss').innerText = moneyFmt.format(avgLoss);
            document.getElementById('stat-pf').innerText = pf.toFixed(2);
            document.getElementById('stat-invested').innerText = moneyFmt.format(invested);
        }

        function renderTrades() {
            const list = document.getElementById('tx-list');
            list.innerHTML = '';
            if(trades.length === 0) {
                list.innerHTML = `<div class="text-center text-zinc-600 py-10 flex flex-col items-center gap-2"><i data-lucide="clipboard-list" class="w-8 h-8 opacity-50"></i><span>No trades yet</span></div>`;
                lucide.createIcons(); return;
            }

            trades.forEach(t => {
                const isWin = t.pl >= 0;
                list.insertAdjacentHTML('beforeend', `
                    <div class="bg-zinc-800/30 border border-zinc-800 p-3 rounded-xl flex justify-between items-center hover:bg-zinc-800/50 transition-colors group">
                        <div class="flex items-center gap-3">
                            <div class="w-1 h-8 rounded-full ${isWin?'bg-emerald-500':'bg-rose-500'}"></div>
                            <div>
                                <div class="font-bold text-white text-sm">${t.ticker} <span class="text-[10px] font-normal text-zinc-500 ml-1">${t.type}</span></div>
                                <div class="text-[10px] text-zinc-500">${t.date} • ${t.strategy || 'No Strategy'}</div>
                            </div>
                        </div>
                        <div class="text-right flex items-center gap-3">
                            <div>
                                <div class="font-bold ${isWin?'text-emerald-400':'text-rose-400'} text-sm">${isWin?'+':''}${moneyFmt.format(t.pl)}</div>
                                <div class="text-[10px] text-zinc-500">${t.roi>0?'+':''}${t.roi}% ROI</div>
                            </div>
                            <button onclick="deleteTrade(${t.id})" class="text-zinc-600 hover:text-rose-500 opacity-0 group-hover:opacity-100 transition-opacity"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                `);
            });
            lucide.createIcons();
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            const monthLabel = document.getElementById('cal-month-year');
            grid.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth(); // 0-11
            
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            monthLabel.innerText = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1).getDay(); // 0 (Sun) - 6 (Sat)
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Empty slots
            for(let i=0; i<firstDay; i++) {
                grid.insertAdjacentHTML('beforeend', `<div></div>`);
            }

            // Days
            for(let d=1; d<=daysInMonth; d++) {
                // Find trades for this day
                const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const dayTrades = trades.filter(t => t.date === dateStr);
                let dayPL = 0;
                dayTrades.forEach(t => dayPL += t.pl);

                let bgClass = "bg-zinc-800/30";
                let textClass = "text-zinc-500";
                
                if (dayTrades.length > 0) {
                    textClass = "text-white font-bold";
                    if (dayPL > 0) bgClass = "bg-emerald-500/20 border border-emerald-500/30";
                    else if (dayPL < 0) bgClass = "bg-rose-500/20 border border-rose-500/30";
                    else bgClass = "bg-zinc-700";
                }

                grid.insertAdjacentHTML('beforeend', `
                    <div class="${bgClass} rounded-lg h-full flex flex-col justify-between p-1 md:p-2 min-h-[50px] transition-all hover:bg-zinc-700/50">
                        <span class="text-[10px] ${textClass}">${d}</span>
                        ${dayTrades.length > 0 ? `<span class="text-[10px] font-bold self-end ${dayPL>=0?'text-emerald-400':'text-rose-400'}">${dayPL>=0?'+':''}${Math.round(dayPL)}</span>` : ''}
                    </div>
                `);
            }
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        // --- BACKUP & RESTORE ---
        function saveData() {
            localStorage.setItem('ptj_trades', JSON.stringify(trades));
            localStorage.setItem('ptj_balance', balance);
        }

        function exportData() {
            const data = { trades, balance, invested };
            navigator.clipboard.writeText(JSON.stringify(data)).then(() => alert("✅ Data copied to clipboard! Save it somewhere safe."));
        }

        function importData() {
            const str = prompt("Paste your backup data here:");
            if(str) {
                try {
                    const data = JSON.parse(str);
                    if(Array.isArray(data.trades)) trades = data.trades;
                    if(data.balance !== undefined) balance = data.balance;
                    if(data.invested !== undefined) invested = data.invested;
                    
                    localStorage.setItem('ptj_invested', invested);
                    saveData();
                    renderStats(); renderCalendar(); renderTrades();
                    alert("✅ Restore successful!");
                } catch(e) { alert("❌ Invalid data format"); }
            }
        }
        
        function resetData() {
            if(confirm("⚠️ Are you sure? This will delete ALL trades.")) {
                localStorage.clear();
                window.location.reload();
            }
        }
    </script>
</body>
</html>
