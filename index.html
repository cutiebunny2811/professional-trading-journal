<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ProTrade Simple</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        body { font-family: 'Inter', sans-serif; background-color: #09090b; color: #e4e4e7; padding-bottom: 40px; -webkit-tap-highlight-color: transparent; }
        input, select { background-color: #18181b; border-color: #27272a; color: white; outline: none; }
        input:focus, select:focus { border-color: #10b981; }
        .tab-active { background-color: #e4e4e7; color: #09090b; font-weight: 700; }
        .tab-inactive { background-color: #18181b; color: #71717a; }
        .cal-day:hover { background-color: #27272a; cursor: pointer; border-color: #3f3f46; }
        .fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="min-h-screen">

    <div class="max-w-6xl mx-auto p-4 md:p-6 space-y-6 fade-in">
        
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <div class="bg-gradient-to-br from-emerald-500 to-green-600 p-2.5 rounded-xl shadow-lg shadow-emerald-900/20">
                    <i data-lucide="wallet" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-white tracking-tight">ProTrade <span class="text-zinc-500">Journal</span></h1>
                    <p class="text-xs text-zinc-500">Simple P/L Tracker</p>
                </div>
            </div>

            <div class="flex items-center gap-2">
                 <button onclick="toggleModal('modal-settings')" class="p-2.5 rounded-xl bg-zinc-900 border border-zinc-800 hover:bg-zinc-800 text-zinc-400">
                    <i data-lucide="save" class="w-5 h-5"></i>
                </button>
                <button onclick="openFundModal()" class="flex items-center gap-2 px-4 py-2.5 rounded-xl bg-zinc-900 border border-zinc-800 hover:bg-zinc-800 text-zinc-300 text-sm font-bold">
                    <i data-lucide="landmark" class="w-4 h-4"></i> Funds
                </button>
                <button onclick="openAddTrade()" class="flex items-center gap-2 px-4 py-2.5 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-white text-sm font-bold shadow-lg shadow-emerald-900/20">
                    <i data-lucide="plus" class="w-4 h-4"></i> Add Trade
                </button>
            </div>
        </div>

        <div class="flex gap-2 overflow-x-auto pb-1 scrollbar-hide">
            <button onclick="setTab('All')" id="tab-All" class="px-6 py-2 rounded-xl text-sm transition-all tab-active">Overview</button>
            <button onclick="setTab('Day Trade')" id="tab-Day Trade" class="px-6 py-2 rounded-xl text-sm transition-all tab-inactive">Day Trade</button>
            <button onclick="setTab('Swing Trade')" id="tab-Swing Trade" class="px-6 py-2 rounded-xl text-sm transition-all tab-inactive">Swing Trade</button>
            <button onclick="setTab('Options')" id="tab-Options" class="px-6 py-2 rounded-xl text-sm transition-all tab-inactive">Options</button>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-zinc-900 border border-zinc-800 p-5 rounded-2xl">
                <p class="text-[10px] text-zinc-500 font-bold uppercase mb-1">Portfolio Value</p>
                <h2 id="val-port" class="text-3xl font-black text-white">$0.00</h2>
            </div>
            <div class="bg-zinc-900 border border-zinc-800 p-5 rounded-2xl">
                <p class="text-[10px] text-zinc-500 font-bold uppercase mb-1">Net Profit</p>
                <h2 id="val-profit" class="text-3xl font-black text-zinc-500">$0.00</h2>
            </div>
            <div class="bg-zinc-900 border border-zinc-800 p-5 rounded-2xl">
                <p class="text-[10px] text-zinc-500 font-bold uppercase mb-1">Win Rate</p>
                <h2 id="val-winrate" class="text-3xl font-black text-blue-500">0%</h2>
            </div>
            <div class="bg-zinc-900 border border-zinc-800 p-5 rounded-2xl">
                <p class="text-[10px] text-zinc-500 font-bold uppercase mb-1">Capital</p>
                <h2 id="val-cap" class="text-3xl font-black text-zinc-600">$0.00</h2>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 bg-zinc-900 border border-zinc-800 rounded-2xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-white flex items-center gap-2"><i data-lucide="calendar" class="w-4 h-4 text-zinc-500"></i> Calendar</h3>
                    <div class="flex gap-2 text-sm font-bold">
                        <button onclick="changeMonth(-1)" class="p-1 text-zinc-500 hover:text-white"><i data-lucide="chevron-left"></i></button>
                        <span id="cal-month" class="w-32 text-center text-white">...</span>
                        <button onclick="changeMonth(1)" class="p-1 text-zinc-500 hover:text-white"><i data-lucide="chevron-right"></i></button>
                    </div>
                </div>
                <div class="grid grid-cols-7 text-center mb-2">
                    <div class="text-[10px] text-zinc-600 font-bold uppercase">Sun</div><div class="text-[10px] text-zinc-600 font-bold uppercase">Mon</div><div class="text-[10px] text-zinc-600 font-bold uppercase">Tue</div><div class="text-[10px] text-zinc-600 font-bold uppercase">Wed</div><div class="text-[10px] text-zinc-600 font-bold uppercase">Thu</div><div class="text-[10px] text-zinc-600 font-bold uppercase">Fri</div><div class="text-[10px] text-zinc-600 font-bold uppercase">Sat</div>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 gap-1 md:gap-2 h-80 md:h-96"></div>
            </div>

            <div class="bg-zinc-900 border border-zinc-800 rounded-2xl p-6 flex flex-col h-[500px]">
                <h3 class="font-bold text-white mb-4">Recent P/L</h3>
                <div id="tx-list" class="flex-1 overflow-y-auto space-y-2 pr-1"></div>
            </div>
        </div>
    </div>

    <div id="modal-trade" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden items-center justify-center p-4 z-50 fade-in">
        <div class="bg-zinc-950 w-full max-w-sm rounded-3xl border border-zinc-800 p-6 space-y-5 shadow-2xl">
            <div class="flex justify-between items-center"><h3 class="text-xl font-bold text-white">Add Trade</h3><button onclick="toggleModal('modal-trade')"><i data-lucide="x" class="text-zinc-500"></i></button></div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs text-zinc-500 uppercase font-bold block mb-1.5">Date</label>
                    <input type="date" id="t-date" class="w-full bg-zinc-900 border border-zinc-800 rounded-xl p-3 text-white text-sm font-bold">
                </div>
                
                <div>
                    <label class="text-xs text-zinc-500 uppercase font-bold block mb-1.5">Strategy</label>
                    <select id="t-strategy" class="w-full bg-zinc-900 border border-zinc-800 rounded-xl p-3 text-white text-sm font-bold">
                        <option value="Day Trade">Day Trade</option>
                        <option value="Swing Trade">Swing Trade</option>
                        <option value="Options">Options</option>
                    </select>
                </div>

                <div>
                    <label class="text-xs text-zinc-500 uppercase font-bold block mb-1.5">Outcome</label>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="setOutcome('Win')" id="btn-win" class="py-3 rounded-xl border border-zinc-800 text-sm font-bold transition-all bg-zinc-900 text-zinc-400">Win</button>
                        <button onclick="setOutcome('Loss')" id="btn-loss" class="py-3 rounded-xl border border-zinc-800 text-sm font-bold transition-all bg-zinc-900 text-zinc-400">Loss</button>
                    </div>
                </div>

                <div>
                    <label class="text-xs text-zinc-500 uppercase font-bold block mb-1.5">P/L Amount ($)</label>
                    <input type="number" id="t-amount" placeholder="0.00" class="w-full bg-zinc-900 border border-zinc-800 rounded-xl p-3 text-white text-xl font-bold placeholder-zinc-700">
                </div>
            </div>

            <button onclick="saveTrade()" class="w-full py-3.5 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-white font-bold text-base shadow-lg shadow-emerald-900/20">Save Trade</button>
        </div>
    </div>

    <div id="modal-funds" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden items-center justify-center p-4 z-50 fade-in">
        <div class="bg-zinc-950 w-full max-w-sm rounded-3xl border border-zinc-800 p-6 space-y-5 shadow-2xl">
            <h3 class="text-xl font-bold text-white">Manage Funds</h3>
            
            <div class="bg-zinc-900 p-1 rounded-xl grid grid-cols-2 gap-1">
                <button onclick="setFundType('Deposit')" id="btn-dep" class="py-2 rounded-lg text-sm font-bold bg-emerald-600 text-white">Deposit</button>
                <button onclick="setFundType('Withdraw')" id="btn-wit" class="py-2 rounded-lg text-sm font-bold text-zinc-400 hover:bg-zinc-800">Withdraw</button>
            </div>

            <div>
                <label class="text-xs text-zinc-500 uppercase font-bold block mb-1.5">Allocated Portfolio</label>
                <select id="f-strategy" class="w-full bg-zinc-900 border border-zinc-800 rounded-xl p-3 text-white text-sm font-bold">
                    <option value="Day Trade">Day Trade</option>
                    <option value="Swing Trade">Swing Trade</option>
                    <option value="Options">Options</option>
                </select>
            </div>

            <div>
                <label class="text-xs text-zinc-500 uppercase font-bold block mb-1.5">Amount ($)</label>
                <input type="number" id="f-amount" placeholder="0.00" class="w-full bg-zinc-900 border border-zinc-800 rounded-xl p-3 text-white text-xl font-bold">
            </div>

            <div class="flex gap-2 mt-2">
                <button onclick="toggleModal('modal-funds')" class="flex-1 py-3 rounded-xl bg-zinc-900 text-zinc-400 font-bold">Cancel</button>
                <button onclick="saveFund()" class="flex-1 py-3 rounded-xl bg-blue-600 text-white font-bold">Update</button>
            </div>
        </div>
    </div>

    <div id="modal-settings" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden items-center justify-center p-4 z-50 fade-in">
        <div class="bg-zinc-900 w-full max-w-sm rounded-3xl border border-zinc-800 p-6 space-y-4 shadow-2xl">
            <h3 class="text-lg font-bold text-white">Data Backup</h3>
            <div class="space-y-3">
                <button onclick="exportData()" class="w-full flex items-center justify-between p-4 rounded-xl bg-zinc-950 border border-zinc-800 hover:border-zinc-600 transition-all">
                    <div class="text-left"><div class="font-bold text-white text-sm">Copy Data</div><div class="text-[10px] text-zinc-500">Save to clipboard</div></div><i data-lucide="copy" class="w-5 h-5 text-emerald-500"></i>
                </button>
                <button onclick="importData()" class="w-full flex items-center justify-between p-4 rounded-xl bg-zinc-950 border border-zinc-800 hover:border-zinc-600 transition-all">
                    <div class="text-left"><div class="font-bold text-white text-sm">Import Data</div><div class="text-[10px] text-zinc-500">Restore from text</div></div><i data-lucide="download" class="w-5 h-5 text-blue-500"></i>
                </button>
                 <button onclick="resetData()" class="w-full flex items-center justify-between p-4 rounded-xl bg-rose-900/10 border border-rose-900/20 hover:bg-rose-900/20 transition-all mt-4">
                    <div class="text-left"><div class="font-bold text-rose-500 text-sm">Reset All</div></div><i data-lucide="trash-2" class="w-5 h-5 text-rose-500"></i>
                </button>
            </div>
            <button onclick="toggleModal('modal-settings')" class="w-full py-3 rounded-xl bg-zinc-950 border border-zinc-800 text-zinc-400 font-bold text-sm mt-2">Close</button>
        </div>
    </div>

    <script>
        lucide.createIcons();
        const money = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
        
        let trades = JSON.parse(localStorage.getItem('simp_trades')) || [];
        let balances = JSON.parse(localStorage.getItem('simp_balances')) || { "Day Trade":0, "Swing Trade":0, "Options":0 };
        
        let curTab = 'All';
        let curDate = new Date();
        let curOutcome = 'Win'; // for modal
        let curFundType = 'Deposit'; // for modal

        // INIT
        renderAll();

        function renderAll() {
            // Stats
            let filtered = (curTab === 'All') ? trades : trades.filter(t => t.strategy === curTab);
            let net = 0; let wins = 0;
            filtered.forEach(t => {
                net += t.amount;
                if (t.amount > 0) wins++;
            });
            
            // Capital Logic
            let cap = 0;
            if (curTab === 'All') cap = Object.values(balances).reduce((a,b)=>a+b,0);
            else cap = balances[curTab] || 0;

            // DOM Update
            document.getElementById('val-port').innerText = money.format(cap + net);
            document.getElementById('val-profit').innerText = (net>=0?'+':'') + money.format(net);
            document.getElementById('val-profit').className = `text-3xl font-black ${net>=0?'text-emerald-500':'text-rose-500'}`;
            document.getElementById('val-cap').innerText = money.format(cap);
            document.getElementById('val-winrate').innerText = (filtered.length>0 ? ((wins/filtered.length)*100).toFixed(0) : 0) + '%';

            // Calendar
            renderCalendar();
            renderList(filtered);
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid'); grid.innerHTML = '';
            const y = curDate.getFullYear(); const m = curDate.getMonth();
            const firstDay = new Date(y, m, 1).getDay();
            const daysInMonth = new Date(y, m+1, 0).getDate();
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            document.getElementById('cal-month').innerText = `${monthNames[m]} ${y}`;

            for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;

            for(let d=1; d<=daysInMonth; d++) {
                const dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                
                // Filter trades by date AND current tab
                let dayTrades = trades.filter(t => t.date === dateStr);
                if (curTab !== 'All') dayTrades = dayTrades.filter(t => t.strategy === curTab);

                let dayPL = dayTrades.reduce((acc, t) => acc + t.amount, 0);
                
                let style = "bg-zinc-800/30 text-zinc-500";
                let plHtml = "";
                
                if (dayTrades.length > 0) {
                    style = dayPL >= 0 ? "bg-emerald-500/10 border border-emerald-500/30 text-white" : "bg-rose-500/10 border border-rose-500/30 text-white";
                    plHtml = `<div class="text-[10px] font-bold mt-1 ${dayPL>=0?'text-emerald-400':'text-rose-400'}">${dayPL>=0?'+':''}${Math.round(dayPL)}</div>`;
                }

                grid.innerHTML += `<div onclick="openAddTrade('${dateStr}')" class="cal-day rounded-lg h-full flex flex-col items-center justify-center min-h-[50px] transition-all ${style}"><span class="text-xs font-bold">${d}</span>${plHtml}</div>`;
            }
        }

        function renderList(list) {
            const el = document.getElementById('tx-list'); el.innerHTML = '';
            if(list.length === 0) { el.innerHTML = '<div class="text-center text-zinc-600 py-10">No trades yet</div>'; return; }
            
            // Sort by Date Desc
            list.sort((a,b) => new Date(b.date) - new Date(a.date));

            list.forEach(t => {
                const isWin = t.amount >= 0;
                el.innerHTML += `
                <div class="bg-zinc-800/40 border border-zinc-800 p-3 rounded-xl flex justify-between items-center group">
                    <div class="flex items-center gap-3">
                        <div class="w-1.5 h-8 rounded-full ${isWin?'bg-emerald-500':'bg-rose-500'}"></div>
                        <div>
                            <div class="font-bold text-white text-sm">${t.date}</div>
                            <div class="text-[10px] text-zinc-500 uppercase tracking-wide">${t.strategy}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="text-base font-bold ${isWin?'text-emerald-400':'text-rose-400'}">${isWin?'+':''}${money.format(t.amount)}</span>
                        <button onclick="delTrade(${t.id})" class="text-zinc-600 hover:text-rose-500 opacity-0 group-hover:opacity-100 transition-all"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>
                </div>`;
            });
            lucide.createIcons();
        }

        // --- ACTIONS ---
        function setTab(t) {
            curTab = t;
            ['All','Day Trade','Swing Trade','Options'].forEach(x => {
                document.getElementById('tab-'+x).className = x===t ? "px-6 py-2 rounded-xl text-sm transition-all tab-active shadow-lg shadow-zinc-900/20" : "px-6 py-2 rounded-xl text-sm transition-all tab-inactive hover:bg-zinc-800";
            });
            renderAll();
        }

        function changeMonth(d) { curDate.setMonth(curDate.getMonth()+d); renderCalendar(); }
        function toggleModal(id) { 
            const m = document.getElementById(id); 
            m.classList.toggle('hidden'); m.classList.toggle('flex'); 
        }

        // --- TRADE LOGIC ---
        function openAddTrade(d = null) {
            toggleModal('modal-trade');
            document.getElementById('t-date').value = d || new Date().toISOString().split('T')[0];
            setOutcome('Win'); // Reset
            document.getElementById('t-amount').value = '';
        }

        function setOutcome(o) {
            curOutcome = o;
            const w = document.getElementById('btn-win');
            const l = document.getElementById('btn-loss');
            if(o==='Win') {
                w.className = "py-3 rounded-xl border border-emerald-500 bg-emerald-600 text-white text-sm font-bold shadow-lg shadow-emerald-900/30";
                l.className = "py-3 rounded-xl border border-zinc-800 bg-zinc-900 text-zinc-400 text-sm font-bold opacity-50";
            } else {
                w.className = "py-3 rounded-xl border border-zinc-800 bg-zinc-900 text-zinc-400 text-sm font-bold opacity-50";
                l.className = "py-3 rounded-xl border border-rose-500 bg-rose-600 text-white text-sm font-bold shadow-lg shadow-rose-900/30";
            }
        }

        function saveTrade() {
            const date = document.getElementById('t-date').value;
            const strat = document.getElementById('t-strategy').value;
            let amt = parseFloat(document.getElementById('t-amount').value);
            
            if(!date || isNaN(amt)) return alert("Please fill date and amount");
            
            // Logic: Loss = negative
            if(curOutcome === 'Loss') amt = -Math.abs(amt);
            else amt = Math.abs(amt);

            trades.push({ id: Date.now(), date, strategy: strat, amount: amt });
            save(); renderAll(); toggleModal('modal-trade');
        }

        function delTrade(id) {
            if(confirm("Delete this?")) { trades = trades.filter(t=>t.id!==id); save(); renderAll(); }
        }

        // --- FUND LOGIC ---
        function openFundModal() {
            toggleModal('modal-funds');
            setFundType('Deposit');
            document.getElementById('f-amount').value = '';
        }

        function setFundType(t) {
            curFundType = t;
            const d = document.getElementById('btn-dep');
            const w = document.getElementById('btn-wit');
            if(t==='Deposit') {
                d.className = "py-2 rounded-lg text-sm font-bold bg-emerald-600 text-white shadow-lg";
                w.className = "py-2 rounded-lg text-sm font-bold text-zinc-400 hover:bg-zinc-800";
            } else {
                d.className = "py-2 rounded-lg text-sm font-bold text-zinc-400 hover:bg-zinc-800";
                w.className = "py-2 rounded-lg text-sm font-bold bg-rose-600 text-white shadow-lg";
            }
        }

        function saveFund() {
            let amt = parseFloat(document.getElementById('f-amount').value);
            const strat = document.getElementById('f-strategy').value;
            if(isNaN(amt)) return alert("Invalid Amount");

            if(curFundType === 'Withdraw') amt = -amt;
            balances[strat] += amt;
            
            localStorage.setItem('simp_balances', JSON.stringify(balances));
            renderAll(); toggleModal('modal-funds');
        }

        // --- SYSTEM ---
        function save() { localStorage.setItem('simp_trades', JSON.stringify(trades)); }
        
        function exportData() {
            const d = { t: trades, b: balances };
            navigator.clipboard.writeText(JSON.stringify(d)).then(()=>alert("Copied!"));
        }
        function importData() {
            const s = prompt("Paste data:");
            if(s) {
                try {
                    const d = JSON.parse(s);
                    trades = d.t || []; balances = d.b || balances;
                    save(); localStorage.setItem('simp_balances', JSON.stringify(balances));
                    renderAll(); alert("Restored!");
                } catch(e) { alert("Error"); }
            }
        }
        function resetData() {
            if(confirm("Reset ALL data?")) { localStorage.clear(); location.reload(); }
        }
    </script>
</body>
</html>
